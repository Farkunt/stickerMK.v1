<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>StickerMK - Pro Meme Generator</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; background-color: #f0f8ff; font-family: 'Arial', sans-serif; overflow: hidden; }
        .container { width: 100vw; height: 177.78vw; max-height: 100vh; max-width: 56.25vh; background: white; display: flex; flex-direction: column; align-items: center; box-shadow: 0 0 30px rgba(0, 191, 255, 0.2); position: relative; padding: 15px; box-sizing: border-box; }
        h1 { color: #00bfff; margin: 5px 0; text-shadow: 0 0 10px rgba(0, 191, 255, 0.5); font-size: 2.2rem; }
        .subtitle { font-size: 0.8rem; color: #555; margin-bottom: 15px; }

        .preview-wrapper { 
            position: relative; width: 100%; aspect-ratio: 1/1; margin-bottom: 15px; 
            border-radius: 12px; overflow: hidden; border: 4px solid #00bfff; background: #000;
        }

        #memeCanvas { width: 100%; height: 100%; display: block; touch-action: none; }

        /* UI Melayang di atas Canvas */
        #cropUI { position: absolute; top: 10px; right: 10px; z-index: 100; display: none; flex-direction: column; gap: 8px; }
        #cropUI button { padding: 8px 12px; font-size: 11px; border-radius: 6px; border: none; color: white; font-weight: bold; cursor: pointer; }

        .controls { width: 100%; display: flex; flex-direction: column; gap: 10px; }
        input, select { width: 100%; padding: 12px; border: 2px solid #00bfff; border-radius: 10px; outline: none; box-sizing: border-box; }
        .btn-group { display: flex; gap: 10px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 10px; background: #00bfff; color: white; font-weight: bold; cursor: pointer; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>StickerMK</h1>
    <div class="subtitle">--by FARID--</div>

    <div class="preview-wrapper">
 <div id="cropUI">
    <button onclick="autoCrop11()" style="background: #f39c12;">CROP 1:1</button>
    <button onclick="fullSizeCrop()" style="background: #00bfff;">FULL SIZE</button>
    <button onclick="applyCrop()" style="background: #32cd32;">OKE</button>
    <button onclick="cancelCrop()" style="background: #ff4444;">BATAL</button>
</div>

        <canvas id="memeCanvas" width="800" height="800"></canvas>
    </div>

    <div class="controls">
        <input type="file" id="imageInput" accept="image/*">
        
        <select id="modeSelect">
            <option value="single">Mode Teks Bawah</option>
            <option value="multi">Mode Multi Teks (Atas & Bawah)</option>
        </select>

        <input type="text" id="topText" class="hidden" placeholder="Teks Atas...">
        <input type="text" id="bottomText" placeholder="Teks Bawah...">

        <div class="btn-group">
            <button onclick="generateMeme()">GENERATE</button>
            <button onclick="downloadMeme()" style="background: #20b2aa;">SIMPAN</button>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('memeCanvas');
    const ctx = canvas.getContext('2d');
    const imageInput = document.getElementById('imageInput');
    const cropUI = document.getElementById('cropUI');
    
    let originalImg = new Image();
    let croppedImg = null;
    let isCropMode = false;
    
    // Variabel Seleksi
    let cropRect = { x: 50, y: 50, w: 300, h: 300 };
    let dragType = null;
    let startX, startY;
    let imgDrawDim = { x:0, y:0, w:800, h:800 }; // Menyimpan dimensi gambar asli di canvas

    imageInput.onchange = (e) => {
        const reader = new FileReader();
        reader.onload = (f) => {
            originalImg.onload = () => {
                isCropMode = true;
                cropUI.style.display = 'flex';
                // Reset posisi kotak ke tengah awal
                cropRect = { x: 250, y: 250, w: 300, h: 300 };
                requestAnimationFrame(cropLoop);
            };
            originalImg.src = f.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    function cropLoop() {
        if (!isCropMode) return;
        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Hitung Rasio biar ga gepeng
        const ratio = Math.min(800 / originalImg.width, 800 / originalImg.height);
        imgDrawDim.w = originalImg.width * ratio;
        imgDrawDim.h = originalImg.height * ratio;
        imgDrawDim.x = (800 - imgDrawDim.w) / 2;
        imgDrawDim.y = (800 - imgDrawDim.h) / 2;
        
        ctx.drawImage(originalImg, imgDrawDim.x, imgDrawDim.y, imgDrawDim.w, imgDrawDim.h);
        
        // Overlay Gelap
        ctx.fillStyle = "rgba(0,0,0,0.6)";
        ctx.fillRect(0, 0, 800, 800);

        // Area Terang
        ctx.save();
        ctx.beginPath();
        ctx.rect(cropRect.x, cropRect.y, cropRect.w, cropRect.h);
        ctx.clip();
        ctx.drawImage(originalImg, imgDrawDim.x, imgDrawDim.y, imgDrawDim.w, imgDrawDim.h);
        ctx.restore();

        // Garis Seleksi & Handle
        ctx.strokeStyle = "#00bfff";
        ctx.lineWidth = 4;
        ctx.strokeRect(cropRect.x, cropRect.y, cropRect.w, cropRect.h);
        ctx.fillStyle = "white";
        ctx.fillRect(cropRect.x + cropRect.w - 20, cropRect.y + cropRect.h - 20, 40, 40);

        requestAnimationFrame(cropLoop);
    }

    // --- LOGIKA GESER & RESIZE (Support Mouse & Touch) ---
    const handleStart = (e) => {
        if (!isCropMode) return;
        const pos = getPos(e);
        // Cek Resize (Pojok kanan bawah)
        if (pos.x > cropRect.x + cropRect.w - 50 && pos.y > cropRect.y + cropRect.h - 50) {
            dragType = "resize";
        } 
        // Cek Geser (Dalam kotak)
        else if (pos.x > cropRect.x && pos.x < cropRect.x + cropRect.w && pos.y > cropRect.y && pos.y < cropRect.y + cropRect.h) {
            dragType = "move";
            startX = pos.x - cropRect.x;
            startY = pos.y - cropRect.y;
        }
    };

    const handleMove = (e) => {
        if (!dragType || !isCropMode) return;
        const pos = getPos(e);
        if (dragType === "resize") {
            cropRect.w = Math.max(50, pos.x - cropRect.x);
            cropRect.h = Math.max(50, pos.y - cropRect.y);
        } else if (dragType === "move") {
            cropRect.x = pos.x - startX;
            cropRect.y = pos.y - startY;
        }
    };

    const handleEnd = () => dragType = null;

    canvas.onmousedown = handleStart;
    window.onmousemove = handleMove;
    window.onmouseup = handleEnd;
    canvas.ontouchstart = (e) => handleStart(e.touches[0]);
    canvas.ontouchmove = (e) => handleMove(e.touches[0]);
    canvas.ontouchend = handleEnd;

    function getPos(e) {
        const r = canvas.getBoundingClientRect();
        return {
            x: (e.clientX - r.left) * (800 / r.width),
            y: (e.clientY - r.top) * (800 / r.height)
        };
    }

    // --- FITUR BARU: FULL SIZE ---
    function fullSizeCrop() {
        cropRect.x = imgDrawDim.x;
        cropRect.y = imgDrawDim.y;
        cropRect.w = imgDrawDim.w;
        cropRect.h = imgDrawDim.h;
    }

function autoCrop11() {
    // Ambil ukuran terkecil antara lebar atau tinggi gambar yang tampil
    const size = Math.min(imgDrawDim.w, imgDrawDim.h);
    
    // Setel kotak crop jadi kotak (1:1) dan posisikan tepat di tengah gambar
    cropRect.w = size;
    cropRect.h = size;
    cropRect.x = imgDrawDim.x + (imgDrawDim.w - size) / 2;
    cropRect.y = imgDrawDim.y + (imgDrawDim.h - size) / 2;
}


    function applyCrop() {
        const temp = document.createElement('canvas');
        temp.width = cropRect.w;
        temp.height = cropRect.h;
        temp.getContext('2d').drawImage(canvas, cropRect.x, cropRect.y, cropRect.w, cropRect.h, 0, 0, cropRect.w, cropRect.h);
        
        croppedImg = new Image();
        croppedImg.onload = () => {
            isCropMode = false;
            cropUI.style.display = 'none';
            generateMeme();
        };
        croppedImg.src = temp.toDataURL();
    }

    function cancelCrop() {
        isCropMode = false;
        cropUI.style.display = 'none';
        ctx.clearRect(0,0,800,800);
    }

    function generateMeme() {
        if (!croppedImg) return;
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, 800, 800);
        const ratio = Math.min(800 / croppedImg.width, 800 / croppedImg.height);
        const w = croppedImg.width * ratio;
        const h = croppedImg.height * ratio;
        ctx.drawImage(croppedImg, (800 - w) / 2, (800 - h) / 2, w, h);

        ctx.fillStyle = "white";
        ctx.strokeStyle = "black";
        ctx.lineWidth = 6;
        ctx.textAlign = "center";
        ctx.font = "bold 60px Impact, Arial";

        if (document.getElementById('modeSelect').value === 'multi') {
            const t = document.getElementById('topText').value.toUpperCase();
            ctx.strokeText(t, 400, 80); ctx.fillText(t, 400, 80);
        }
        const b = document.getElementById('bottomText').value.toUpperCase();
        ctx.strokeText(b, 400, 750); ctx.fillText(b, 400, 750);
    }

    function downloadMeme() {
        const link = document.createElement('a');
        link.download = 'meme_stickermk.png';
        link.href = canvas.toDataURL();
        link.click();
    }

    document.getElementById('modeSelect').onchange = (e) => {
        document.getElementById('topText').classList.toggle('hidden', e.target.value !== 'multi');
    };
</script>
</body>
</html>
